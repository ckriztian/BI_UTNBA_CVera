---
title: "Simulaciones y Montecarlo"
author: "Cristian Vera"
date: "2025-07-06"
output: html_document
---

¬øQu√© es el M√©todo Monte Carlo? üé≤
El M√©todo Monte Carlo üé≤ es una t√©cnica estad√≠stica de simulaci√≥n que se utiliza para entender el impacto de la incertidumbre y el riesgo en modelos matem√°ticos y financieros üìà. Es especialmente √∫til cuando las matem√°ticas tradicionales son demasiado complejas o no se pueden aplicar f√°cilmente.

Origen del M√©todo Monte Carlo üè∞
El nombre "Monte Carlo" üè∞ se debe a la famosa ciudad de M√≥naco conocida por sus casinos y juegos de azar. El t√©rmino fue introducido por Stanislaw Ulam y Nicholas Metropolis en la d√©cada de 1940 durante su trabajo en el Proyecto Manhattan, aunque la idea de la simulaci√≥n estoc√°stica se remonta a los trabajos de John von Neumann en los a√±os 30.

<!-- El objetivo de este c√≥digo es realizar una simulaci√≥n de Monte Carlo para estimar la 
probabilidad de ganar un "premio" al elegir un ping√ºino al azar de una especie objetivo 
espec√≠fica en el conjunto de datos de ping√ºinos. -->

```{r}
# Cargar la biblioteca
install.packages("palmerpenguins")
library(palmerpenguins)
```

```{r}
# Cargar el conjunto de datos de ping√ºinos
data("penguins")

```

```{r}
penguins
```

```{r}
# N√∫mero de simulaciones de Monte Carlo
num_simulaciones <- 10000  # Define el n√∫mero de simulaciones que se realizar√°n

# Funci√≥n para realizar una simulaci√≥n de Monte Carlo y calcular la probabilidad
simulacion_loteria_ping√ºinos <- function(especie_objetivo) {
  especie_elegida <- sample(penguins$species, 1)  # Selecciona una especie aleatoria del conjunto de datos
  return(especie_elegida == especie_objetivo)     # Devuelve TRUE si la especie elegida es igual a la especie objetivo
}

# Programa interactivo
cat("¬°Bienvenido a la Loter√≠a de Ping√ºinos!\n")  # Imprime un mensaje de bienvenida
cat("Especies disponibles en el conjunto de datos:\n")  # Imprime las especies disponibles
especies_disponibles <- unique(penguins$species)  # Obtiene las especies √∫nicas del conjunto

print(especies_disponibles, sep = "\n")  # Imprime las especies disponibles

especie_objetivo <- readline(prompt = "Ingresa la especie objetivo (elige una de las especies de arriba): ")  # Solicita al usuario ingresar una especie objetivo

# Verificar si la especie ingresada es v√°lida
if (especie_objetivo %in% especies_disponibles) {  # Verifica si la especie objetivo est√° en la lista de especies disponibles
  # Realizar las simulaciones de Monte Carlo
  set.seed(123)  # Establece una semilla para reproducibilidad
  resultados <- replicate(num_simulaciones, simulacion_loteria_ping√ºinos(especie_objetivo))  # Realiza las simulaciones

  # Calcular la probabilidad de ganar un premio
  probabilidad_ganar_premio <- sum(resultados) / num_simulaciones  # Calcula la probabilidad de que la especie objetivo sea elegida en las simulaciones

  # Imprimir la probabilidad
  cat("Probabilidad de ganar un premio si eliges un ping√ºino al azar de la especie",
      especie_objetivo, ":", probabilidad_ganar_premio, "\n")  # Imprime la probabilidad calculada
} else {
  cat("Especie ingresada no v√°lida. Aseg√∫rate de elegir una de las especies disponibles en la lista.\n")  # Imprime un mensaje de error si la especie objetivo no es v√°lida
}

```
<!-- El objetivo de este c√≥digo es simular el apareamiento entre dos especies de ping√ºinos seleccionadas por el usuario y calcular la probabilidad de que ocurra un apareamiento exitoso entre esas dos especies. -->

```{r}
library(palmerpenguins)
library(dplyr)

```

```{r}
# Obtener la lista de todas las especies √∫nicas en el conjunto de datos
especies_disponibles <- unique(penguins$species)  # Extrae las especies √∫nicas
especies_disponibles  # Imprime la lista de especies disponibles

# Solicitar al usuario que ingrese las especies que desea aparear
especie1 <- readline("Ingrese la primera especie: ")
especie2 <- readline("Ingrese la segunda especie: ")

# Verificar si las especies ingresadas son v√°lidas
if (!(especie1 %in% especies_disponibles) || !(especie2 %in% especies_disponibles)) {
  cat("Al menos una de las especies ingresadas no es v√°lida.\n")
  
} else if (especie1 == especie2) {
  cat("Las especies ingresadas son iguales. Deben ser diferentes para el apareamiento.\n")
  
} else {
  # Filtrar el conjunto de datos para incluir solo las dos especies de inter√©s
  especies <- c(especie1, especie2)
  pinguinos <- penguins %>%
    filter(species %in% especies)

  # N√∫mero de simulaciones Monte Carlo
  num_simulaciones <- 1000

  # Vector para almacenar los resultados de las simulaciones
  resultados_apareamiento <- numeric(num_simulaciones)

  # Realizar las simulaciones
  for (i in 1:num_simulaciones) {
    pareja <- sample(1:nrow(pinguinos), 2)
    especie_pareja1 <- pinguinos$species[pareja[1]]
    especie_pareja2 <- pinguinos$species[pareja[2]]

    resultados_apareamiento[i] <- ifelse(especie_pareja1 != especie_pareja2, 1, 0)
  }

  # Calcular la probabilidad de √©xito de apareamiento
  probabilidad_exito <- mean(resultados_apareamiento)

  # Mostrar el resultado
  cat("Probabilidad de √©xito de apareamiento entre especies:", probabilidad_exito, "\n")
}


```

‚úÖ C√≥digo Mejorado: Apareamiento entre macho y hembra de diferentes especies

Versi√≥n m√°s flexible del c√≥digo, donde el usuario puede ingresar:
- La especie del macho.
- La especie de la hembra.

La simulaci√≥n generar√° apareamientos solo entre esas dos combinaciones espec√≠ficas.

```{r}
library(dplyr)
library(palmerpenguins)

# Obtener especies disponibles
especies_disponibles <- unique(penguins$species)
print(especies_disponibles)

# Solicitar al usuario las dos especies
especie_macho <- readline("Ingrese la especie del macho: ")
especie_hembra <- readline("Ingrese la especie de la hembra: ")

# Validaciones
if (!(especie_macho %in% especies_disponibles) || !(especie_hembra %in% especies_disponibles)) {
  cat("Al menos una de las especies ingresadas no es v√°lida.\n")
  
} else if (especie_macho == especie_hembra) {
  cat("Las especies deben ser diferentes para esta simulaci√≥n.\n")
  
} else {
  # Filtrar ping√ºinos machos de la primera especie y hembras de la segunda
  machos <- penguins %>%
    filter(species == especie_macho, sex == "male")
  
  hembras <- penguins %>%
    filter(species == especie_hembra, sex == "female")

  # Validar que haya datos suficientes
  if (nrow(machos) == 0 || nrow(hembras) == 0) {
    cat("No hay suficientes datos para una o ambas combinaciones de sexo y especie.\n")
  } else {
    # Definir n√∫mero de simulaciones
    num_simulaciones <- 1000
    resultados_apareamiento <- numeric(num_simulaciones)

    # Realizar simulaciones (macho de especie 1 con hembra de especie 2)
    for (i in 1:num_simulaciones) {
      macho <- sample_n(machos, 1)
      hembra <- sample_n(hembras, 1)

      # Se considera √©xito si son de especies distintas (ya est√° garantizado por el filtro)
      resultados_apareamiento[i] <- ifelse(macho$body_mass_g > hembra$body_mass_g, 1, 0)

    }

    # Calcular probabilidad de √©xito
    probabilidad_exito <- mean(resultados_apareamiento)

    # Mostrar resultado
    cat("Probabilidad de √©xito de apareamiento entre un macho de", especie_macho,
        "y una hembra de", especie_hembra, ":", probabilidad_exito, "\n")
  }
}

```

```{r}
# Cargar librer√≠as necesarias
library(shiny)
library(dplyr)
library(palmerpenguins)

# Definir la interfaz de usuario
ui <- fluidPage(
  titlePanel("Simulador de Apareamiento de Ping√ºinos"),
  
  sidebarLayout(
    sidebarPanel(
      selectInput("especie_macho", "Seleccione la especie del macho:",
                  choices = unique(na.omit(penguins$species))),
      
      selectInput("especie_hembra", "Seleccione la especie de la hembra:",
                  choices = unique(na.omit(penguins$species))),
      
      numericInput("num_simulaciones", "Cantidad de simulaciones:",
                   value = 1000, min = 1),
      
      actionButton("simular", "Simular")
    ),
    
    mainPanel(
      verbatimTextOutput("resultado")
    )
  )
)

# Definir la l√≥gica del servidor
server <- function(input, output) {
  observeEvent(input$simular, {
    
    especie_macho <- input$especie_macho
    especie_hembra <- input$especie_hembra
    num_simulaciones <- input$num_simulaciones
    
    # Validaciones
    if (especie_macho == especie_hembra) {
      output$resultado <- renderPrint({
        "Las especies deben ser diferentes para esta simulaci√≥n."
      })
      
    } else {
      machos <- penguins %>%
        filter(species == especie_macho, sex == "male", !is.na(body_mass_g))
      
      hembras <- penguins %>%
        filter(species == especie_hembra, sex == "female", !is.na(body_mass_g))
      
      if (nrow(machos) == 0 || nrow(hembras) == 0) {
        output$resultado <- renderPrint({
          "No hay suficientes datos para una o ambas combinaciones de sexo y especie."
        })
        
      } else {
        resultados_apareamiento <- numeric(num_simulaciones)
        
        for (i in 1:num_simulaciones) {
          macho <- sample_n(machos, 1)
          hembra <- sample_n(hembras, 1)
          
          resultados_apareamiento[i] <- ifelse(macho$body_mass_g > hembra$body_mass_g, 1, 0)
        }
        
        probabilidad_exito <- mean(resultados_apareamiento)
        
        output$resultado <- renderPrint({
          cat("Probabilidad de √©xito de apareamiento entre un macho de", especie_macho,
              "y una hembra de", especie_hembra, ":", probabilidad_exito, "\n")
        })
      }
    }
  })
}

# Ejecutar la aplicaci√≥n
shinyApp(ui = ui, server = server)

```


